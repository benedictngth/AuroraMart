<!DOCTYPE html>

<html>
  <head>
    <title>Manage Products</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f7f9;
        margin: 0;
        padding: 20px;
      }

      .container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 30px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      .product-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .product-table th,
      .product-table td {
        padding: 12px 10px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .product-table th {
        background-color: #f0f0f0;
        font-weight: bold;
      }

      .product-table tbody tr:hover {
        background-color: #fafafa;
      }

      .status-pill {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
        color: white;
        text-align: center;
      }

      .status-active {
        background-color: #28a745;
      }

      .status-inactive {
        background-color: #dc3545;
        /* Red */
      }

      .controls-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .search-form input {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px 0 0 5px;
        outline: none;
        height: 38px;
        box-sizing: border-box;
        font-size: medium;
      }

      .search-form button {
        padding: 8px 15px;
        background-color: #555;
        color: white;
        border: none;
        cursor: pointer;
        height: 38px;
        vertical-align: top;
      }

      .new-product-link {
        display: inline-block;
        margin-bottom: 20px;
        padding: 8px 15px;
        background-color: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        font-weight: bold;
      }

      .filter-sort-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 20px;
        align-items: flex-end;
      }
      .filter-sort-bar > div {
        min-width: 120px;
        flex-grow: 1;
      }
      .filter-sort-bar label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
        font-size: 0.9em;
      }
      .filter-sort-bar select,
      .filter-sort-bar input[type="number"],
      .filter-sort-bar input[type="text"] {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
        box-sizing: border-box;
      }
      .filter-sort-bar button[type="submit"] {
        background-color: #5cb85c;
        color: white;
        cursor: pointer;
        border: none;
      }
      .back-link {
        display: inline-block;
        margin-bottom: 20px;
        text-decoration: none;
        color: #007bff;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <a href="{% url 'adminpanel:staff_landing' %}" class="back-link"
        >Back to Dashboard</a
      >
      <h1>Product Catalog Management</h1>
      <hr />

      <form
        method="get"
        action="{% url 'adminpanel:adminpanel_product_list' %}"
        class="main-controls-form"
      >
        <div class="controls-header">
          <a href="{% url 'adminpanel:new_product' %}" class="new-product-link">
            + Add New Product</a
          >

          <div class="search-form">
            <input
              type="text"
              name="q"
              placeholder="Search by Name or SKU..."
              value="{{ search_query|default:'' }}"
            />
          </div>
        </div>
        <hr />

        <div class="filter-sort-bar">
          {% for hidden in filter_form.hidden_fields %}{{ hidden }}{% endfor %}
          {% for hidden in sort_form.hidden_fields %}{{ hidden }}{% endfor %}

          <div style="flex: 1">
            <label for="{{ filter_form.is_active.id_for_label }}"
              >{{ filter_form.is_active.label }}</label
            >
            {{ filter_form.is_active }}
          </div>

          <div style="flex: 1">
            <label for="{{ filter_form.category.id_for_label }}"
              >{{ filter_form.category.label }}</label
            >
            {{ filter_form.category }}
          </div>

          <div style="flex: 1">
            <label>Stock Qty Range</label>

            {% for error in filter_form.non_field_errors %}
            <small style="color: red; display: block">{{ error }}</small>
            {% endfor %}

            <div style="display: flex; gap: 5px">
              {{ filter_form.min_stock }} {{ filter_form.max_stock }}
            </div>

            {% if filter_form.min_stock.errors %}
            <small style="color: red; display: block"
              >{{ filter_form.min_stock.errors.as_text }}</small
            >
            {% endif %} {% if filter_form.max_stock.errors %}
            <small style="color: red; display: block"
              >{{ filter_form.max_stock.errors.as_text }}</small
            >
            {% endif %}
          </div>

          <div style="flex: 1">
            <label for="{{ sort_form.sort.id_for_label }}"
              >{{ sort_form.sort.label }}</label
            >
            {{ sort_form.sort }}
          </div>

          <div style="display: flex; gap: 10px; align-self: flex-end">
            <button type="submit" style="height: 38px; padding: 0 15px">
              Apply
            </button>

            <a
              href="{% url 'adminpanel:adminpanel_product_list' %}"
              class="clear-filters-button"
              style="
                height: 38px;
                line-height: 38px;
                padding: 0 15px;
                text-decoration: none;
                text-align: center;
                white-space: nowrap;
              "
            >
              Clear Filters
            </a>
          </div>
        </div>
      </form>
      <hr />

      <table class="product-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>SKU Code</th>
            <th>Category</th>
            <th>Subcategory</th>
            <th>Quantity on hand</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
          <tr>
            <td>{{ product.product_name }}</td>
            <td>{{product.sku_code}}</td>
            <td>{{product.category}}</td>
            <td>{{product.subcategory}}</td>
            <td>{{product.quantity_on_hand}}</td>

            <td>
              {% if product.is_active %}
              <span class="status-pill status-active">Active</span>
              {% else %}
              <span class="status-pill status-inactive">Inactive</span>
              {% endif %}
            </td>
            <td>
              <a
                href="{% url 'adminpanel:modify_product' product_pk=product.sku_code %}"
              >
                Modify
              </a>
            </td>
          </tr>

          {% endfor %}
        </tbody>
      </table>
    </div>
  </body>
</html>
