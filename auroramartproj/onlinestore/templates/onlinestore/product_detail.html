{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AuroraMart | {{ product.product_name }}</title>
    <link rel="stylesheet" href="{% static 'onlinestore/css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'onlinestore/css/product_style.css' %}" />
  </head>
  <body>
    {% include 'onlinestore/_navBar.html'%}

    <main class="product-detail-content">
      <div class="product-detail-card">
        <h1 class="product-name">{{ product.product_name }}</h1>
        <p class="product-sku">SKU: {{ product.sku_code }}</p>
        <p class="product-price">${{ product.unit_price }}</p>
        <p class="product-rating">
          Rating: â˜… {{ product.product_rating|default:"N/A" }}
        </p>

        {% if product.quantity_on_hand == 0 %}
        <p class="product-stock stock-out">Out of Stock</p>
        {% elif product.quantity_on_hand < 10 %}
        <p class="product-stock stock-low">
          Low Stock ({{ product.quantity_on_hand }} remaining)
        </p>
        {% else %}
        <p class="product-stock stock-available">In Stock</p>
        {% endif %}

        <div class="product-description">
          <h3>Description</h3>
          <p>
            {{ product.product_description|linebreaks|default:"No description available." }}
          </p>
        </div>

       <form action="{% url 'add_to_cart' product_pk=product.pk %}" method="post" class="add-to-cart-form" data-product-max="{{ product.quantity_on_hand }}">
            {% csrf_token %}
            
            <input type="hidden" name="update" value="True">
            
            {% if redirect_to_cart_flag %}
            <input type="hidden" name="next_page" value="cart_detail">
            {% endif %}

            {% if category_id %}
            <input type="hidden" name="category" value="{{ category_id }}">
            {% endif %}

            {% if subcategory_id %}
            <input type="hidden" name="subcategory" value="{{ subcategory_id }}">
            {% endif %}

            <div class="form-group">
                <label for="quantity">Quantity:</label>
                
                <input type="number" 
                       name="quantity" 
                       value="{{ cart_quantity|default:1 }}" 
                       min="1" 
                       max="{{ product.quantity_on_hand }}"
                       class="quantity-input"
                >
            </div>
            <button type="submit" class="add-to-cart-btn" {% if product.quantity_on_hand == 0 %}disabled{% endif %}>
                {% if cart_quantity > 0 %}Update Cart{% else %}Add to Cart{% endif %}
            </button>
        </form> 

        {% if recommendations %}
        <div class="recommendations-section">
          <h3>You might also like</h3>
          <ul class="recommendations-grid">
            {% for recommendation in recommendations %}
            <li class="recommendation-item">
              <a href="{% url 'product_detail' product_pk=recommendation.product_sku %}?subcategory={{recommendation.product_subcategory}}">
          {{ recommendation.product_name }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div> 
        {% else %}
        <div class = "no-recommendation">
          <h3> Unable to find recommendations</h3>
        </div>
        {% endif %}

      </div>
    </main>

  </body>
</html>
